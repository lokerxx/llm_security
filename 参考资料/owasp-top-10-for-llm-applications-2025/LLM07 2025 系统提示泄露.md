# LLM07:2025 系统提示泄露

## 描述

系统提示泄露漏洞指的是LLM中用于引导模型行为的系统提示或指令可能包含不应被发现的敏感信息。这些系统提示旨在根据应用程序的要求指导模型输出，但可能无意中泄露秘密信息。当这些信息被发现时，可能被攻击者用于实施其他攻击。

需要注意的是，系统提示本身不应被视为秘密，也不应用作安全控制。因此，诸如凭据、连接字符串等敏感数据不应包含在系统提示语言中。

如果系统提示包含角色和权限的描述信息或敏感数据（如连接字符串或密码），问题的核心并不是这些信息的泄露，而是应用程序通过将这些职责委托给LLM，未能实现强会话管理和授权检查。敏感数据被存储在不应存放的地方，才是根本的安全风险。

**总结**：系统提示本身的泄露并不是主要风险——真正的安全风险在于敏感信息泄露、系统防护绕过、不正确的权限分离等底层问题。

---

## 常见风险示例

1. **敏感功能暴露**  
   系统提示可能泄露敏感信息或功能，例如系统架构、API密钥、数据库凭据或用户令牌。这些信息可能被攻击者提取并用于未授权访问。例如，一个系统提示包含工具所用数据库类型的信息，可能让攻击者针对其进行SQL注入攻击。

2. **内部规则暴露**  
   系统提示可能泄露内部决策过程的信息，攻击者可利用这些信息了解应用程序的工作原理，从而利用其弱点。例如：
   > "用户的每日交易限额为$5000，总贷款金额为$10,000。"  
   > 攻击者可据此绕过应用的安全控制，例如执行超过限额的交易或突破贷款金额限制。

3. **过滤标准披露**  
   系统提示可能要求模型过滤或拒绝敏感内容。例如：
   > "如果用户请求其他用户的信息，始终回复‘对不起，我无法协助您的请求’。"  

4. **权限和用户角色的披露**  
   系统提示可能泄露应用程序的内部角色结构或权限级别。例如：
   > "管理员用户角色授予修改用户记录的完全访问权限。"  
   > 攻击者可以利用这些信息尝试权限提升攻击。

---

## 预防和缓解策略

1. **将敏感数据与系统提示分离**  
   避免直接在系统提示中嵌入敏感信息（如API密钥、认证密钥、数据库名称、用户角色、权限结构等）。应将此类信息外部化，存储在模型无法直接访问的系统中。

2. **避免依赖系统提示进行严格行为控制**  
   由于LLM易受提示注入等攻击的影响，建议尽量避免依赖系统提示控制模型行为。相反，应使用外部系统来确保行为。例如，检测和防止有害内容应在外部系统中完成。

3. **实施防护机制**  
   在LLM之外实施防护机制。尽管通过训练使模型遵循特定行为（如不泄露其系统提示）可能有效，但不能保证模型始终遵守。可以通过独立系统检查输出是否符合预期，优于依赖系统提示。

4. **确保安全控制独立于LLM实施**  
   关键控制（如权限分离、授权边界检查等）不应委托给LLM，无论是通过系统提示还是其他方式。必须以可审计的确定性方式实施这些控制。如果某些任务需要不同级别的访问权限，应使用多个代理，每个代理仅配置执行所需任务的最小权限。

---

## 示例攻击场景

### 场景 #1: **凭据泄露**  
一个LLM的系统提示包含工具所用的一组凭据。系统提示泄露给攻击者后，攻击者可以使用这些凭据执行其他操作。

### 场景 #2: **绕过限制**  
一个LLM的系统提示禁止生成冒犯性内容、外部链接和代码执行。攻击者提取此系统提示后，通过提示注入攻击绕过这些指令，从而实施远程代码执行攻击。